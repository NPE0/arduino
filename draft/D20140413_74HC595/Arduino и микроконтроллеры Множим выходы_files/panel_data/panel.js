setHttps();width=800;height=600;query={};tmp=location.search.substr(1).split("&");socket=false;interval=false;network=false;var position={vkontakte:1,odnoklassniki:2,mailru:3,facebook:4,twitter:5,google:6,yandex:7,livejournal:8,openid:9,guest:10,flickr:11,lastfm:12,linkedin:13,liveid:14,soundcloud:15,steam:16,vimeo:17,webmoney:18,youtube:19,foursquare:20,tumblr:21,googleplus:22,dudu:23};var names={ru:{vkontakte:"ВКонтакте",odnoklassniki:"Одноклассники",mailru:"Mail.ru",facebook:"Facebook",twitter:"Twitter",google:"Google",yandex:"Яндекс",livejournal:"Живой\u00a0Журнал",openid:"OpenID",guest:"Гость",flickr:"Flickr",lastfm:"Last.FM",linkedin:"LinkedIn",liveid:"Live ID",soundcloud:"SoundCloud",steam:"Steam",vimeo:"Vimeo",webmoney:"WebMoney",youtube:"YouTube",foursquare:"foursquare",tumblr:"tumblr",googleplus:"Google+",dudu:"dudu"},en:{vkontakte:"VK",odnoklassniki:"Odnoklassniki",mailru:"Mail.ru",facebook:"Facebook",twitter:"Twitter",google:"Google",yandex:"Yandex",livejournal:"LiveJournal",openid:"OpenID",guest:"Guest",flickr:"Flickr",lastfm:"Last.FM",linkedin:"LinkedIn",liveid:"Live ID",soundcloud:"SoundCloud",steam:"Steam",vimeo:"Vimeo",webmoney:"WebMoney",youtube:"YouTube",foursquare:"foursquare",tumblr:"tumblr",googleplus:"Google+",dudu:"dudu"}};var lang=query.lang?query.lang:(navigator.language?navigator.language:navigator.userLanguage).substr(0,2);if(lang!="ru"&&lang!="en"){names[lang]=names.en;}for(i=0;i<tmp.length;i++){tmp2=tmp[i].split("=");query[tmp2[0]]=tmp2[1];}function setHttps(){https=location.href.match(/^https/i)?true:false;if(!https){var url="https"+location.href.substr(4);location.href=url;}}function isIE(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var ver=new Number(RegExp.$1);if(ver<=8){return ver;}}return false;}function getById(id){return document.getElementById(id);}function addEvent(object,event,handler,param){if(object.addEventListener){object.addEventListener(event,function(e){handler(object,e);},false);}else{if(object.attachEvent){object.attachEvent("on"+event,function(e){handler(object,e);});}else{object["on"+event]=function(e){handler(object,e);};}}}function childProcessing(childs,processing){var idx=0;while(childs[idx]){processing(childs[idx]);idx++;}}function popup(id,url){if(network){var network_elem=getById(network);var network_childs=network_elem.childNodes?network_elem.childNodes:[];childProcessing(network_childs,function(child){if(child.style){child.style.background="none";}});if(network_elem.style){network_elem.style.backgroundImage="url(img/"+(query.display=="1"?"small8":"panel8")+".png)";}clearInterval(interval);}network=id;if(typeof url!="undefined"){if(document.cookie){var expires=new Date();expires.setTime(expires.getTime()+(31536000000));document.cookie+=id+"url = "+url+"; expires = "+expires.toGMTString()+"; path=/";}}var elem_id=getById(id);var elem_childs=elem_id.childNodes?elem_id.childNodes:[];childProcessing(elem_childs,function(child){if(child.style){child.style.background="url(img/pre"+(query.display=="1"?"small":"loader")+".png) no-repeat";}});if(document.cookie){expires=new Date();expires.setTime(expires.getTime()+(86400000));document.cookie="q = "+encodeURIComponent(location.toString())+((typeof query.otherprov)!="undefined"?query.otherprov:"")+"; expires = "+expires.toGMTString()+"; path=/";document.cookie="window = 0; path=/";}var win_params="width="+width+",height="+height+",left="+((screen.width-width)/2)+",top="+((screen.height-height)/2);if(id=="livejournal"||id=="steam"){win_params="width="+screen.width+", height="+screen.height+", top=0, left=0, fullscreen=yes, scrollbar=auto";}var src="https://"+location.host+"/";if(id!="webmoney"&&id!="livejournal"&&id!="openid"){src+="auth";}else{src+="url";}src+=".php?name="+network+"&window=0&lang="+query.lang+"&client="+query.client+"&fields="+query.fields+(query.altway?"&altway=1":"")+"&optional="+query.optional+"&redirect_uri="+query.redirect_uri+"&callback="+query.callback+(typeof url!="undefined"?"&url="+url:"")+"&screen="+screen.width+"x"+screen.height+"&host="+query.host+"&verify="+query.verify+"&q="+encodeURIComponent(location.toString());if(typeof query.altway!="undefined"){sendMessage(src);}else{sendMessage("open");uLogin=window.open(src,"uLogin",win_params);interval=setInterval(check,100);}return false;}function check(){if(uLogin){if(uLogin.closed){sendMessage("close");clearNetwork();}}}function clearNetwork(){var network_elem=getById(network);if(network_elem){var network_childs=network_elem.childNodes?network_elem.childNodes:[];childProcessing(network_childs,function(child){if(child.style){child.style.background="none";}});if(network_elem.style){network_elem.style.filter="";network_elem.style.opacity="";}clearInterval(interval);network=false;}}function receiver(token,redirect_uri,callback,q){if(redirect_uri){r_prot=redirect_uri.match(/^https/i)?"https":"http";if(query.protocol){if(r_prot!=query.protocol){parsed_uri=redirect_uri.split(":");parsed_uri.splice(0,1);redirect_uri=query.protocol+":"+parsed_uri.join(":");}}sendMessage("receive");window.location.href=redirect_uri+"?token="+token+"&callback="+callback+"&q="+encodeURIComponent(q);}else{setTimeout(function(){sendMessage(token);},20);}}function sendMessage(msg){if(!query.xdm_c||!query.xdm_e||!query.xdm_p){return;}if(!socket){socket=new easyXDM.Socket({swf:isIE()?"https://"+location.host+"/js/easyxdm.swf":"",onReady:function(){try{socket.postMessage(msg);}catch(e){window.setTimeout(function(){socket.postMessage(msg);},200);}}});}else{try{socket.postMessage(msg);}catch(e){window.setTimeout(function(){socket.postMessage(msg);},200);}}}function redirect(token,redirect_uri){r_prot=redirect_uri.match(/^https/i)?"https":"http";if(r_prot=="http"){sendMessage("receive");window.location.href="http://"+location.host+"/http.html?redirect_uri="+encodeURIComponent(redirect_uri)+"&token="+token+"&q="+encodeURIComponent(location.href);}else{var form=document.createElement("form");form.action=redirect_uri;form.method="post";form.target="_top";form.style.display="none";var input=document.createElement("input");input.type="hidden";input.name="token";input.value=token;form.appendChild(input);document.body.appendChild(form);setTimeout(function(){form.submit();},20);}}function link_over(object,event){var element=object;if(!element){element=event.srcElement;}if(element.id==null){return;}if(network!=element.id){if(element.style){element.style.filter="alpha(opacity=65) progid:DXImageTransform.Microsoft.AlphaImageLoader(src=transparent.png, sizingMethod='crop')";element.style.opacity="0.65";}}}function link_out(object,event){var element=object;if(!element){element=event.srcElement;}if(element.id==null){return;}if(network!=element.id){if(element.style){element.style.filter="";element.style.opacity="";}}}function link_click(object,event){var element=object;if(!element){element=event.srcElement;}if(element.id==null){return;}popup(element.id);}var list=query.providers.split(","),list_elem=getById("list"),small_width=21,big_width=42,ml_small=5,ml_big=10,small=query.display=="1";if(list_elem){list_elem.style.width=list.length*(small?small_width:big_width)+"px";list_elem.style.height=(small?"16":"32")+"px";}for(var i=0;i<list.length;i++){var alink=document.createElement("div");if(i==list.length-1){ml_big-=3;ml_small-=2;}alink.innerHTML='<a id="{network}" style="margin: 0 {mt}px 0 0 ;background: url(img/{img}.png) 0 -{top}px" href="#{network}"><img src="img/blank.gif" style="width:{size}px;height:{size}px;cursor:pointer;" alt="{network_lang}"/></a>'.replace(/\{network\}/ig,list[i]).replace(/\{mt\}/ig,small?ml_small:ml_big).replace(/\{img\}/ig,small?"small8":"panel8").replace(/\{top\}/ig,position[list[i]]*(small?23:35)+(small?-4:3)).replace(/\{size\}/ig,small?16:32).replace(/\{network_lang\}/ig,names[lang][list[i]]);addEvent(alink.firstChild,"mouseover",link_over);addEvent(alink.firstChild,"mouseout",link_out);addEvent(alink.firstChild,"click",link_click);list_elem.appendChild(alink.firstChild);}sendMessage("ready");